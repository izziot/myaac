<div class="card mb-4">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Game Servers Management</h5>
    </div>
    <div class="card-body">
        {% if message %}
        <div class="alert alert-{{ messageType }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        {% endif %}
        
        <button type="button" class="btn btn-success mb-3" data-toggle="modal" data-target="#addServerModal">
            <i class="fas fa-plus"></i> Add Server
        </button>
        
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Display Name</th>
                        <th>Database</th>
                        <th>Server Path</th>
                        <th>Default</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% if servers is empty %}
                    <tr>
                        <td colspan="8" class="text-center">No servers configured. Click "Add Server" to add your first game server.</td>
                    </tr>
                    {% else %}
                    {% for server in servers %}
                    <tr>
                        <td>{{ server.id }}</td>
                        <td><strong>{{ server.name }}</strong></td>
                        <td>{{ server.display_name }}</td>
                        <td>
                            <small>{{ server.database_host ?: 'default' }}:{{ server.database_port }}</small><br>
                            <span class="text-muted">{{ server.database_name }}</span>
                        </td>
                        <td><small>{{ server.server_path ?: '-' }}</small></td>
                        <td>
                            {% if server.is_default %}
                            <span class="badge badge-success">Default</span>
                            {% else %}
                            <span class="badge badge-secondary">No</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if server.status == 'online' %}
                            <span class="badge badge-success">Online</span>
                            {% elseif server.status == 'maintenance' %}
                            <span class="badge badge-warning">Maintenance</span>
                            {% else %}
                            <span class="badge badge-danger">Offline</span>
                            {% endif %}
                        </td>
                        <td>
                            <button type="button" class="btn btn-sm btn-info" data-toggle="modal" data-target="#editServerModal{{ server.id }}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <form method="post" style="display:inline;">
                                <input type="hidden" name="action" value="test_connection">
                                <input type="hidden" name="id" value="{{ server.id }}">
                                <button type="submit" class="btn btn-sm btn-secondary" title="Test Connection">
                                    <i class="fas fa-plug"></i>
                                </button>
                            </form>
                            <form method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this server?');">
                                <input type="hidden" name="action" value="delete">
                                <input type="hidden" name="id" value="{{ server.id }}">
                                <button type="submit" class="btn btn-sm btn-danger" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add Server Modal -->
<div class="modal fade" id="addServerModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <form method="post">
                <input type="hidden" name="action" value="add">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Server</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Server Name *</label>
                                <input type="text" class="form-control" name="name" required placeholder="e.g., sovereign, world2">
                                <small class="form-text text-muted">Unique identifier for this server</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Display Name</label>
                                <input type="text" class="form-control" name="display_name" placeholder="e.g., Sovereign - Main Server">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Status</label>
                                <select class="form-control" name="status">
                                    <option value="online">Online</option>
                                    <option value="offline">Offline</option>
                                    <option value="maintenance">Maintenance</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="is_default" id="is_default_add">
                                    <label class="form-check-label" for="is_default_add">Set as Default Server</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    <h6>Database Configuration</h6>
                    <p class="text-muted small">Leave empty to use MyAAC's default database connection.</p>
                    
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Host</label>
                                <input type="text" class="form-control" name="database_host" placeholder="{{ defaultHost }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Port</label>
                                <input type="number" class="form-control" name="database_port" value="{{ defaultPort }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Username</label>
                                <input type="text" class="form-control" name="database_username" placeholder="{{ defaultUser }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Password</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" name="database_password" id="password_add">
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('password_add')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Database Name *</label>
                        <input type="text" class="form-control" name="database_name" required placeholder="e.g., canary_sof">
                    </div>
                    
                    <hr>
                    <h6>Server Paths</h6>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Server Path</label>
                                <input type="text" class="form-control" name="server_path" placeholder="/srv/servers/sovereign/">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Config Path</label>
                                <input type="text" class="form-control" name="config_path" value="config/config.lua">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Data Path</label>
                                <input type="text" class="form-control" name="data_path" value="data/">
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    <h6>Git Configuration (Optional)</h6>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Git Repository</label>
                                <input type="text" class="form-control" name="git_repo" placeholder="git@github.com:user/repo.git">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Git Branch</label>
                                <input type="text" class="form-control" name="git_branch" value="main">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Server</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Server Modals -->
{% for server in servers %}
<div class="modal fade" id="editServerModal{{ server.id }}" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <form method="post">
                <input type="hidden" name="action" value="edit">
                <input type="hidden" name="id" value="{{ server.id }}">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Server: {{ server.name }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Server Name *</label>
                                <input type="text" class="form-control" name="name" required value="{{ server.name }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Display Name</label>
                                <input type="text" class="form-control" name="display_name" value="{{ server.display_name }}">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Status</label>
                                <select class="form-control" name="status">
                                    <option value="online" {{ server.status == 'online' ? 'selected' : '' }}>Online</option>
                                    <option value="offline" {{ server.status == 'offline' ? 'selected' : '' }}>Offline</option>
                                    <option value="maintenance" {{ server.status == 'maintenance' ? 'selected' : '' }}>Maintenance</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="is_default" id="is_default_edit_{{ server.id }}" {{ server.is_default ? 'checked' : '' }}>
                                    <label class="form-check-label" for="is_default_edit_{{ server.id }}">Set as Default Server</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    <h6>Database Configuration</h6>
                    <p class="text-muted small">Leave fields empty to use MyAAC's default database connection.</p>
                    
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Host</label>
                                <input type="text" class="form-control" name="database_host" value="{{ server.database_host }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Port</label>
                                <input type="number" class="form-control" name="database_port" value="{{ server.database_port }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Username</label>
                                <input type="text" class="form-control" name="database_username" value="{{ server.database_username }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Password</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" name="database_password" id="password_edit_{{ server.id }}" value="{{ server.database_password }}">
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('password_edit_{{ server.id }}')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Database Name *</label>
                        <input type="text" class="form-control" name="database_name" required value="{{ server.database_name }}">
                    </div>
                    
                    <hr>
                    <h6>Server Paths</h6>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Server Path</label>
                                <input type="text" class="form-control" name="server_path" value="{{ server.server_path }}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Config Path</label>
                                <input type="text" class="form-control" name="config_path" value="{{ server.config_path }}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Data Path</label>
                                <input type="text" class="form-control" name="data_path" value="{{ server.data_path }}">
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    <h6>Git Configuration</h6>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Git Repository</label>
                                <input type="text" class="form-control" name="git_repo" value="{{ server.git_repo }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Git Branch</label>
                                <input type="text" class="form-control" name="git_branch" value="{{ server.git_branch }}">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<script>
function togglePassword(inputId) {
    var input = document.getElementById(inputId);
    if (input.type === "password") {
        input.type = "text";
    } else {
        input.type = "password";
    }
}
</script>
